<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç¬¬2æ­¥-ä¸»é¢˜</title>
  <link rel="stylesheet" href="../assets/styles.css" />
  <style>
    .theme-preview {
      text-align: center;
      padding: 30px 20px;
      background: linear-gradient(135deg, var(--bg) 0%, #fff 100%);
      border-radius: 16px;
      margin: 16px 0;
      border: 2px dashed var(--border);
    }
    .theme-preview-icon {
      font-size: 80px;
      margin-bottom: 16px;
      animation: bounce 2s ease infinite;
    }
    .theme-preview-name {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 8px;
    }
    .theme-preview-desc {
      font-size: 14px;
      color: var(--muted);
      max-width: 400px;
      margin: 0 auto;
    }
    .theme-select-wrapper {
      position: relative;
      display: block;
    }
    .theme-select-wrapper::after {
      content: 'â–¼';
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--primary);
      pointer-events: none;
      font-size: 12px;
    }
    #theme {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      width: 100%;
      padding: 16px 45px 16px 16px;
      font-size: 16px;
      font-weight: 600;
      color: var(--primary);
      background: #fff;
      border: 2px solid var(--primary);
      border-radius: 14px;
      cursor: pointer;
      outline: none;
    }
    #theme:focus {
      box-shadow: 0 0 0 4px rgba(231, 76, 60, 0.15);
    }
    #theme option {
      font-size: 16px;
      padding: 10px;
      color: #333;
    }
    .decoration-sample {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 16px;
      font-size: 24px;
    }
  </style>
</head>
<body>
<header>
  <div class="header-inner">
    <div class="brand">
      <h1>é­å°ç‰ Â· ä¸»æŒç¨¿ç”Ÿæˆå™¨</h1>
      <div class="sub">ä¸€æ­¥ä¸€æ­¥å¡«å†™ â†’ æ‰‹åŠ¨é€‰ç¯èŠ‚ â†’ ç”Ÿæˆå¯ç›´æ¥ç…§è¯»çš„ä¸»æŒç¨¿</div>
    </div>
    <div class="stepper" aria-label="æ­¥éª¤">
      <span class="step" data-step>1. åŸºç¡€ä¿¡æ¯</span>
<span class="step" data-step>2. ä¸»é¢˜</span>
<span class="step" data-step>3. é£æ ¼</span>
<span class="step" data-step>4. äººç‰©</span>
<span class="step" data-step>5. ç¯èŠ‚</span>
<span class="step" data-step>6. ç”Ÿæˆ</span>
    </div>
  </div>
</header>

<main>
  
<section class="card">
  <h2>ç¬¬ 2 æ­¥ï¼šé€‰æ‹©ä¸»é¢˜</h2>
  <p class="hint">ä¸»é¢˜å†³å®š"ç¯èŠ‚åº“"å’Œæ•´ä½“æ°›å›´ã€‚ä½ ä¹‹åä¼šæ‰‹åŠ¨å‹¾é€‰å…·ä½“ç¯èŠ‚ã€‚</p>

  <div style="margin-bottom: 16px;">
    <label for="theme">ä¸»é¢˜ç±»å‹</label>
    <select id="theme" style="width: 100%; padding: 16px; border-radius: 14px; border: 2px solid #e74c3c; font-size: 16px; font-weight: 600; background: white; color: #e74c3c; z-index: 1000; min-height: 48px;">
      <option value="generic">é€šç”¨å®´ä¼š</option>
      <option value="wedding">å©šç¤¼</option>
      <option value="engagement">è®¢å©šå®´</option>
      <option value="homecoming">å›é—¨å®´</option>
      <option value="graduation">å‡å­¦å®´</option>
      <option value="thanks_teacher">è°¢å¸ˆå®´</option>
      <option value="baby100">ç™¾æ—¥å®´/æ»¡æœˆå®´</option>
      <option value="birthday">ç”Ÿæ—¥å®´</option>
      <option value="longevity">å¯¿å®´</option>
      <option value="housewarming">ä¹”è¿å®´</option>
      <option value="annualparty">å…¬å¸å¹´ä¼š/åº†åŠŸå®´</option>
    </select>
  </div>

  <div class="theme-preview" id="themePreview">
    <div class="theme-preview-icon" id="previewIcon">ğŸŠ</div>
    <div class="theme-preview-name" id="previewName">é€šç”¨å®´ä¼š</div>
    <div class="theme-preview-desc" id="previewDesc">ä»»ä½•å®´ä¼šéƒ½èƒ½ç”¨çš„å…œåº•ç‰ˆæœ¬ã€‚</div>
    <div class="decoration-sample" id="decorationSample"></div>
  </div>

  <div class="actions">
    <button class="ghost" id="back">ä¸Šä¸€æ­¥</button>
    <button class="primary" id="next">ä¸‹ä¸€æ­¥ï¼šé€‰é£æ ¼</button>
  </div>
</section>

<section class="card">
  <h2>ğŸ’¡ æç¤º</h2>
  <p class="hint">é€‰æ‹©ä¸åŒä¸»é¢˜åï¼Œé¡µé¢ä¼šå˜æ¢å¯¹åº”çš„å–œåº†é…è‰²å’ŒèƒŒæ™¯éŸ³ä¹ï¼Œè®©ä½ æå‰æ„Ÿå—æ°›å›´ï¼</p>
</section>

</main>

<script src="../assets/app.js"></script>
<script>
  setStepper(1);
  
// ä½¿ç”¨ app.js ä¸­çš„ä¸»é¢˜é…ç½®ï¼Œä¸éœ€è¦é‡å¤å£°æ˜

(async () => {
  try {
    const st = getState();
    let themes;
    try {
      themes = await loadThemes();
    } catch (e) {
      console.error('åŠ è½½ä¸»é¢˜åˆ—è¡¨å¤±è´¥:', e);
      themes = { themes: [] };
    }
    const sel = qs("#theme");
    if (!sel) {
      console.error('æœªæ‰¾åˆ°ä¸»é¢˜é€‰æ‹©æ¡†');
      return;
    }
    if (themes.themes && themes.themes.length > 0) {
      sel.innerHTML = themes.themes.map(t => `<option value="${t.id}">${t.name}</option>`).join("");
    } else {
      // ä½¿ç”¨é»˜è®¤ä¸»é¢˜åˆ—è¡¨
      const defaultThemes = [
        { id: 'generic', name: 'é€šç”¨å®´ä¼š' },
        { id: 'wedding', name: 'å©šç¤¼' },
        { id: 'engagement', name: 'è®¢å©šå®´' },
        { id: 'homecoming', name: 'å›é—¨å®´' },
        { id: 'graduation', name: 'å‡å­¦å®´' },
        { id: 'thanks_teacher', name: 'è°¢å¸ˆå®´' },
        { id: 'baby100', name: 'ç™¾æ—¥å®´/æ»¡æœˆå®´' },
        { id: 'birthday', name: 'ç”Ÿæ—¥å®´' },
        { id: 'longevity', name: 'å¯¿å®´' },
        { id: 'housewarming', name: 'ä¹”è¿å®´' },
        { id: 'annualparty', name: 'å…¬å¸å¹´ä¼š/åº†åŠŸå®´' }
      ];
      sel.innerHTML = defaultThemes.map(t => `<option value="${t.id}">${t.name}</option>`).join("");
      themes.themes = defaultThemes;
    }

    const updatePreview = () => {
      try {
        const id = sel.value;
        const t = themes.themes.find(x => x.id === id);
        const config = THEME_CONFIG[id] || THEME_CONFIG.generic;
        
        // æ›´æ–°é¢„è§ˆ
        const previewIcon = qs("#previewIcon");
        if (previewIcon) previewIcon.textContent = config.icon || 'ğŸŠ';
        const previewName = qs("#previewName");
        if (previewName) previewName.textContent = t?.name || '';
        const previewDesc = qs("#previewDesc");
        if (previewDesc) previewDesc.textContent = t?.desc || '';
        
        // æ›´æ–°è£…é¥°é¢„è§ˆ
        const decorationSample = qs("#decorationSample");
        if (decorationSample && config.decorations) {
          decorationSample.innerHTML = config.decorations
            .map(d => `<span>${d}</span>`)
            .join('');
        }
        
        // åº”ç”¨ä¸»é¢˜åˆ°é¡µé¢
        if (document.body) {
          document.body.setAttribute('data-theme', id);
        }
        
        // é‡æ–°å¯åŠ¨é£˜è½è£…é¥°
        if (config.decorations) {
          startFallingDecorations(config.decorations);
        }
        
        // æ›´æ–°éŸ³ä¹
        createMusicPlayer(id);
      } catch (err) {
        console.error('æ›´æ–°ä¸»é¢˜é¢„è§ˆå¤±è´¥:', err);
      }
    };

    sel.value = st.themeId || (themes.themes[0]?.id || 'generic');
    updatePreview();
    sel.addEventListener("change", updatePreview);

    const backBtn = qs("#back");
    if (backBtn) backBtn.addEventListener("click", () => go("step1-basic.html"));
    const nextBtn = qs("#next");
    if (nextBtn) nextBtn.addEventListener("click", () => {
      const id = sel.value;
      const t = themes.themes.find(x => x.id === id);
      setState({ themeId: id, themeName: t?.name || "" , selectedSegments: [] });
      go("step3-style.html");
    });
  } catch (error) {
    console.error('ä¸»é¢˜é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
  }
})();
</script>
</body>
</html>
